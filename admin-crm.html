<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>PowerLab - CRM Dashboard</title>
  <link rel="stylesheet" href="assets/style/index/variables.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <!-- jsPDF + AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  
  <!-- html2canvas para capturar gr√°ficos -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <!-- SheetJS para Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.min.js"></script>
  
  <!-- Papa Parse para CSV -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: linear-gradient(135deg, #f5f5f5 0%, #e8f4f8 100%);
      font-family: 'Montserrat', sans-serif;
      color: #333;
      min-height: 100vh;
    }

    /* ===== HEADER ===== */
    .crm-header {
      background: linear-gradient(135deg, #2980b9 0%, #3498db 100%);
      color: #fff;
      padding: 25px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .crm-header-content {
      max-width: 1600px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .crm-header h1 {
      font-size: 2em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .crm-header-right {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .date-filter {
      background: rgba(255,255,255,0.2);
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      font-size: 0.9em;
      cursor: pointer;
    }

    .date-filter:hover {
      background: rgba(255,255,255,0.3);
    }

    /* ===== CONTAINER ===== */
    .crm-container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    /* ===== TABS ===== */
    .crm-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid #ddd;
      flex-wrap: wrap;
      overflow-x: auto;
    }

    .crm-tab-btn {
      padding: 12px 20px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      color: #666;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .crm-tab-btn:hover {
      color: #3498db;
    }

    .crm-tab-btn.active {
      color: #3498db;
      border-bottom-color: #3498db;
    }

    .crm-tab-content {
      display: none;
      animation: fadeIn 0.3s ease-in;
    }

    .crm-tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* ===== KPI CARDS ===== */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .kpi-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-left: 4px solid #3498db;
      transition: all 0.3s;
    }

    .kpi-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

    .kpi-card.success {
      border-left-color: #51ff00;
    }

    .kpi-card.warning {
      border-left-color: #f39c12;
    }

    .kpi-card.danger {
      border-left-color: #ff6b6b;
    }

    .kpi-label {
      color: #7f8c8d;
      font-size: 0.9em;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .kpi-value {
      font-size: 2.2em;
      font-weight: 700;
      color: #2980b9;
      margin-bottom: 10px;
    }

    .kpi-change {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9em;
    }

    .kpi-change.positive {
      color: #27ae60;
    }

    .kpi-change.negative {
      color: #e74c3c;
    }

    .sparkline {
      height: 30px;
      margin-top: 10px;
    }

    /* ===== CHARTS ===== */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .chart-card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .chart-card h3 {
      color: #2980b9;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .chart-container {
      position: relative;
      height: 300px;
      margin-bottom: 15px;
    }

    /* ===== EXPORT MENU ===== */
    .export-menu {
      position: relative;
      display: inline-block;
    }

    .export-btn {
      padding: 10px 16px;
      background: #34495e;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .export-btn:hover {
      background: #2c3e50;
    }

    .export-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      min-width: 250px;
      display: none;
      z-index: 1000;
      margin-top: 5px;
    }

    .export-dropdown.active {
      display: block;
    }

    .export-option {
      padding: 12px 16px;
      border: none;
      background: none;
      cursor: pointer;
      width: 100%;
      text-align: left;
      font-size: 0.95em;
      color: #333;
      transition: all 0.2s;
      border-bottom: 1px solid #f0f0f0;
    }

    .export-option:last-child {
      border-bottom: none;
    }

    .export-option:hover {
      background: #f8f9fa;
      color: #3498db;
      padding-left: 20px;
    }

    /* ===== TABLE ===== */
    .table-wrapper {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow-x: auto;
    }

    /* Wrapper para tabla con scroll interno */
    .table-scroll-container {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
      max-height: 500px;
      overflow-y: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    /* Asegurar que el thead quede fijo mientras scrollea */
    .table-scroll-container table thead {
      position: sticky;
      top: 0;
      z-index: 10;
    }

    th {
      background: #f0f8ff;
      color: #2980b9;
      padding: 15px;
      text-align: left;
      font-weight: 700;
      border-bottom: 2px solid #3498db;
      cursor: pointer;
      user-select: none;
    }

    th:hover {
      background: #e8f4ff;
    }

    td {
      padding: 12px 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    tr:hover {
      background: #f9f9f9;
    }

    tr:nth-child(even) {
      background: #f5f5f5;
    }

    /* ===== FILTERS ===== */
    .filters-bar {
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .filter-group label {
      font-weight: 600;
      color: #2980b9;
      font-size: 0.9em;
    }

    .filter-group input,
    .filter-group select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.95em;
    }

    .filter-group input:focus,
    .filter-group select:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    /* ===== BUTTONS ===== */
    .btn {
      padding: 10px 16px;
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover {
      background: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .btn.success {
      background: #51ff00;
      color: #333;
    }

    .btn.success:hover {
      background: #45d600;
    }

    .btn.danger {
      background: #ff6b6b;
    }

    .btn.danger:hover {
      background: #ff5252;
    }

    /* ===== LOADING ===== */
    .loader {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 30px 50px;
      border-radius: 12px;
      z-index: 9999;
      text-align: center;
    }

    .loader.active {
      display: block;
    }

    .loader-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #3498db;
      border-top: 5px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ===== NOTIFICATION ===== */
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #27ae60;
      color: #fff;
      padding: 15px 20px;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 10000;
      animation: slideIn 0.3s ease-in;
      display: none;
    }

    .notification.active {
      display: block;
    }

    /* ===== MODAL DE EDICI√ìN ===== */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 5000;
      justify-content: center;
      align-items: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 20px;
      max-width: 500px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      animation: slideUp 0.3s ease-out;
    }

    .modal-content::-webkit-scrollbar {
      width: 8px;
    }

    .modal-content::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    .modal-content::-webkit-scrollbar-thumb {
      background: #3498db;
      border-radius: 10px;
    }

    .modal-content::-webkit-scrollbar-thumb:hover {
      background: #2980b9;
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      border-bottom: 2px solid #ecf0f1;
      padding-bottom: 12px;
    }

    .modal-header h2 {
      margin: 0;
      color: #2980b9;
      font-size: 20px;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 28px;
      color: #7f8c8d;
      cursor: pointer;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: #e74c3c;
    }

    .form-group {
      margin-bottom: 12px;
    }

    .form-group.form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .form-group.form-row .form-group {
      margin-bottom: 0;
    }

    .form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
      color: #2c3e50;
      font-size: 13px;
    }

    .form-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #bdc3c7;
      border-radius: 5px;
      font-size: 13px;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }

    .form-group input:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #ecf0f1;
    }

    .btn-primary, .btn-secondary {
      padding: 9px 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #3498db;
      color: white;
    }

    .btn-primary:hover {
      background: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }

    .btn-secondary {
      background: #ecf0f1;
      color: #2c3e50;
    }

    .btn-secondary:hover {
      background: #bdc3c7;
    }

    .edit-btn {
      background: #f39c12;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.2s;
    }

    .edit-btn:hover {
      background: #e67e22;
    }

    @keyframes slideIn {
      from { transform: translateX(400px); }
      to { transform: translateX(0); }
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 768px) {
      .crm-header-content {
        flex-direction: column;
        align-items: flex-start;
      }

      .crm-header h1 {
        font-size: 1.5em;
      }

      .crm-header-right {
        width: 100%;
      }

      .crm-container {
        padding: 15px 10px;
      }

      .kpi-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }

      .chart-container {
        height: 250px;
      }

      .crm-tabs {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .crm-tab-btn {
        padding: 10px 15px;
        font-size: 0.9em;
      }

      .filters-bar {
        flex-direction: column;
      }

      .filter-group {
        width: 100%;
      }

      .filter-group input,
      .filter-group select {
        width: 100%;
      }

      table {
        font-size: 0.85em;
      }

      th, td {
        padding: 8px 10px;
      }

      .export-menu {
        width: 100%;
      }

      .export-btn {
        width: 100%;
      }

      .export-dropdown {
        right: auto;
        left: 0;
        min-width: 200px;
      }
    }

    @media (max-width: 480px) {
      .crm-header h1 {
        font-size: 1.2em;
      }

      .kpi-value {
        font-size: 1.8em;
      }

      .chart-container {
        height: 200px;
      }

      .crm-tab-btn {
        padding: 8px 10px;
        font-size: 0.8em;
      }

      table {
        font-size: 0.75em;
      }

      th, td {
        padding: 6px 8px;
      }
    }

    /* ===== ALERT BADGE ===== */
    .alert-badge {
      display: inline-block;
      background: #ff6b6b;
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8em;
      font-weight: 600;
      margin-left: 10px;
    }

    .alert-badge.warning {
      background: #f39c12;
    }

    /* ===== SEGMENT TAG ===== */
    .segment-tag {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8em;
      font-weight: 600;
      margin-right: 5px;
    }

    .segment-tag.new {
      background: #3498db;
      color: #fff;
    }

    .segment-tag.recurring {
      background: #2ecc71;
      color: #fff;
    }

    .segment-tag.vip {
      background: #f39c12;
      color: #fff;
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="crm-header">
    <div class="crm-header-content">
      <h1>üìä PowerLab CRM</h1>
      <div class="crm-header-right">
        <select class="date-filter" id="dateRangeFilter">
          <option value="today">Hoy</option>
          <option value="week">Esta semana</option>
          <option value="month" selected>Este mes</option>
          <option value="lastMonth">Mes pasado</option>
          <option value="3months">√öltimos 3 meses</option>
          <option value="year">Este a√±o</option>
          <option value="all">Todo el tiempo</option>
        </select>
        <button class="btn" id="refreshDataBtn">üîÑ Refrescar datos</button>
        <div class="export-menu">
          <button class="export-btn" id="globalExportBtn">üì• Exportar Dashboard</button>
          <div class="export-dropdown" id="globalExportMenu">
            <button class="export-option" data-action="export-pdf">üìä PDF Completo</button>
            <button class="export-option" data-action="export-xlsx">üìÑ Excel Ejecutivo</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- TABS -->
  <div class="crm-container">
    <div class="crm-tabs">
      <button class="crm-tab-btn active" data-tab="dashboard">üìà Dashboard</button>
      <button class="crm-tab-btn" data-tab="ventas">üõí Ventas</button>
      <button class="crm-tab-btn" data-tab="productos">üì¶ Productos</button>
      <button class="crm-tab-btn" data-tab="clientes">üë• Clientes</button>
    </div>

    <!-- TAB: DASHBOARD -->
    <div id="dashboard" class="crm-tab-content active">
      <div class="kpi-grid" id="kpiGrid">
        <div class="kpi-card">
          <div class="kpi-label">Ventas del mes</div>
          <div class="kpi-value" id="kpiMonthlySales">S/. 0.00</div>
          <div class="kpi-change positive">
            <span>‚Üë 12.5%</span> vs mes anterior
          </div>
          <canvas class="sparkline" id="sparklineSales"></canvas>
        </div>

        <div class="kpi-card">
          <div class="kpi-label">N√∫mero de pedidos</div>
          <div class="kpi-value" id="kpiOrders">0</div>
          <div class="kpi-change positive">
            <span>‚Üë 5.2%</span> vs mes anterior
          </div>
          <canvas class="sparkline" id="sparklineOrders"></canvas>
        </div>

        <div class="kpi-card success">
          <div class="kpi-label">Ticket promedio</div>
          <div class="kpi-value" id="kpiAverageTicket">S/. 0.00</div>
          <div class="kpi-change positive">
            <span>‚Üë 3.1%</span> vs mes anterior
          </div>
          <canvas class="sparkline" id="sparklineTicket"></canvas>
        </div>

        <div class="kpi-card warning">
          <div class="kpi-label">Productos sin stock</div>
          <div class="kpi-value" id="kpiNoStock">0</div>
          <div class="kpi-change negative">
            <span>‚ö†Ô∏è</span> Requiere atenci√≥n
          </div>
        </div>
      </div>

      <div class="charts-grid">
        <div class="chart-card">
          <h3>üìà Evoluci√≥n de Ventas</h3>
          <div class="chart-container">
            <canvas id="chartSalesEvolution"></canvas>
          </div>
          <button class="btn" style="width: 100%;" data-export="chartSalesEvolution">üì• Exportar gr√°fico</button>
        </div>

        <div class="chart-card">
          <h3>üíπ Ventas por Categor√≠a</h3>
          <div class="chart-container">
            <canvas id="chartSalesByCategory"></canvas>
          </div>
          <button class="btn" style="width: 100%;" data-export="chartSalesByCategory">üì• Exportar gr√°fico</button>
        </div>

        <div class="chart-card">
          <h3>üéØ Distribuci√≥n de Categor√≠as</h3>
          <div class="chart-container">
            <canvas id="chartCategoryDistribution"></canvas>
          </div>
          <button class="btn" style="width: 100%;" data-export="chartCategoryDistribution">üì• Exportar gr√°fico</button>
        </div>

        <div class="chart-card">
          <h3>‚≠ê Top 10 Productos</h3>
          <div class="chart-container">
            <canvas id="chartTopProducts"></canvas>
          </div>
          <button class="btn" style="width: 100%;" data-export="chartTopProducts">üì• Exportar gr√°fico</button>
        </div>
      </div>
    </div>

    <!-- TAB: VENTAS -->
    <div id="ventas" class="crm-tab-content">
      <div class="filters-bar">
        <div class="filter-group">
          <label>Desde:</label>
          <input type="date" id="filterDateFrom">
        </div>
        <div class="filter-group">
          <label>Hasta:</label>
          <input type="date" id="filterDateTo">
        </div>
        <div class="filter-group">
          <label>Cliente:</label>
          <input type="text" id="filterClient" placeholder="Buscar..." style="min-width: 150px;">
        </div>
        <button class="btn" id="filterApplyBtn">üîç Filtrar</button>
        <button class="btn" id="filterResetBtn" style="background: #95a5a6;">üîÑ Limpiar</button>
      </div>

      <div class="charts-grid">
        <div class="chart-card">
          <h3>üìä Ventas por d√≠a</h3>
          <div class="chart-container">
            <canvas id="chartSalesByDay"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <h3>‚è∞ Ventas por hora</h3>
          <div class="chart-container">
            <canvas id="chartSalesByHour"></canvas>
          </div>
        </div>
      </div>

      <div class="table-wrapper">
        <h3 style="margin-bottom: 15px; color: #2980b9;">üìã Tabla de Compras</h3>
        <div style="margin-bottom: 15px;">
          <div class="export-menu" style="display: inline-block;">
            <button class="export-btn" id="exportSalesBtn">üì• Exportar</button>
            <div class="export-dropdown" id="exportSalesMenu">
              <button class="export-option" data-action="sales-csv">üìÑ CSV</button>
              <button class="export-option" data-action="sales-xlsx">üìä Excel</button>
              <button class="export-option" data-action="sales-pdf">üìã PDF</button>
            </div>
          </div>
        </div>
        <table id="salesTable">
          <thead>
            <tr>
              <th onclick="sortTable(this)">ID</th>
              <th onclick="sortTable(this)">Cliente</th>
              <th onclick="sortTable(this)">Celular</th>
              <th onclick="sortTable(this)">Fecha</th>
              <th onclick="sortTable(this)">Productos</th>
              <th onclick="sortTable(this)">Total</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- TAB: PRODUCTOS -->
    <div id="productos" class="crm-tab-content">
      <div class="charts-grid">
        <div class="chart-card">
          <h3>üì¶ Stock actual por producto</h3>
          <div class="chart-container">
            <canvas id="chartStockByProduct"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <h3>üîÑ Rotaci√≥n de inventario</h3>
          <div class="chart-container">
            <canvas id="chartInventoryRotation"></canvas>
          </div>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
        <div class="kpi-card danger">
          <div class="kpi-label">Bajo Stock (&lt; 10)</div>
          <div class="kpi-value" id="kpiLowStock">0</div>
          <div class="alert-badge">Requiere reorden</div>
        </div>
        <div class="kpi-card warning">
          <div class="kpi-label">Valor total inventario</div>
          <div class="kpi-value" id="kpiInventoryValue">S/. 0.00</div>
        </div>
      </div>

      <div class="table-wrapper">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h3 style="margin: 0; color: #2980b9;">üìã Tabla de Productos</h3>
          <button class="btn-action" id="btnAddProduct" onclick="openAddProductModal()" style="background: #2980b9; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">+ Nuevo Producto</button>
        </div>
        <div style="margin-bottom: 15px;">
          <div class="export-menu" style="display: inline-block;">
            <button class="export-btn" id="exportProductsBtn">üì• Exportar</button>
            <div class="export-dropdown" id="exportProductsMenu">
              <button class="export-option" data-action="products-csv">üìÑ CSV</button>
              <button class="export-option" data-action="products-xlsx">üìä Excel</button>
              <button class="export-option" data-action="products-pdf">üìã PDF</button>
            </div>
          </div>
        </div>
        <div class="table-scroll-container">
          <table id="productsTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Categor√≠a</th>
                <th>Precio</th>
                <th>Stock</th>
                <th>Alerta</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="table-wrapper" style="margin-top: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h3 style="margin: 0; color: #e74c3c;">üéâ Tabla de Promociones</h3>
          <button class="btn-action" id="btnAddPromo" onclick="openAddPromoModal()" style="background: #e74c3c; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">+ Nueva Promoci√≥n</button>
        </div>
        <div style="margin-bottom: 15px;">
          <div class="export-menu" style="display: inline-block;">
            <button class="export-btn" id="exportPromosBtn">üì• Exportar</button>
            <div class="export-dropdown" id="exportPromosMenu">
              <button class="export-option" data-action="promos-csv">üìÑ CSV</button>
              <button class="export-option" data-action="promos-xlsx">üìä Excel</button>
              <button class="export-option" data-action="promos-pdf">üìã PDF</button>
            </div>
          </div>
        </div>
        <div class="table-scroll-container">
          <table id="promosTable">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Categor√≠a</th>
                <th>Precio Original</th>
                <th>Descuento</th>
                <th>Precio Final</th>
                <th>Stock</th>
                <th>Alerta</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TAB: CLIENTES -->
    <div id="clientes" class="crm-tab-content">
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="kpi-label">Total de clientes</div>
          <div class="kpi-value" id="kpiTotalCustomers">0</div>
          <div class="kpi-change positive"><span>‚Üë 8.3%</span> vs mes anterior</div>
        </div>
        <div class="kpi-card success">
          <div class="kpi-label">Clientes VIP</div>
          <div class="kpi-value" id="kpiVIPCustomers">0</div>
          <div class="kpi-change positive"><span>‚Üë 2</span> nuevos VIP</div>
        </div>
        <div class="kpi-card">
          <div class="kpi-label">Clientes recurrentes</div>
          <div class="kpi-value" id="kpiRecurringCustomers">0</div>
          <div class="kpi-change positive"><span>‚Üë 15%</span> tasa de retenci√≥n</div>
        </div>
        <div class="kpi-card warning">
          <div class="kpi-label">Clientes nuevos</div>
          <div class="kpi-value" id="kpiNewCustomers">0</div>
          <div class="kpi-change positive"><span>‚Üë 5</span> este mes</div>
        </div>
      </div>

      <div class="charts-grid">
        <div class="chart-card">
          <h3>üéØ Segmentaci√≥n de clientes</h3>
          <div class="chart-container">
            <canvas id="chartCustomerSegmentation"></canvas>
          </div>
        </div>

        <div class="chart-card">
          <h3>üìà Adquisici√≥n de clientes</h3>
          <div class="chart-container">
            <canvas id="chartCustomerAcquisition"></canvas>
          </div>
        </div>
      </div>

      <div class="table-wrapper">
        <h3 style="margin-bottom: 15px; color: #2980b9;">üë• Top 20 Clientes por Monto</h3>
        <div style="margin-bottom: 15px;">
          <div class="export-menu" style="display: inline-block;">
            <button class="export-btn" id="exportCustomersBtn">üì• Exportar</button>
            <div class="export-dropdown" id="exportCustomersMenu">
              <button class="export-option" data-action="customers-csv">üìÑ CSV</button>
              <button class="export-option" data-action="customers-xlsx">üìä Excel</button>
              <button class="export-option" data-action="customers-pdf">üìã PDF</button>
            </div>
          </div>
        </div>
        <table id="customersTable">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Celular</th>
              <th>Segmento</th>
              <th>Compras</th>
              <th>Total invertido</th>
              <th>√öltima compra</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- MODAL: EDITAR PRODUCTO -->
  <div id="editProductModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚úèÔ∏è Editar Producto</h2>
        <button class="modal-close" onclick="closeEditProductModal()">&times;</button>
      </div>
      <form id="editProductForm">
        <div class="form-group">
          <label>ID (no editable)</label>
          <input type="text" id="editProductId" disabled style="background: #eee; cursor: not-allowed;">
        </div>
        <div class="form-group">
          <label>Nombre</label>
          <input type="text" id="editProductName" required>
        </div>
        <div class="form-group">
          <label>Categor√≠a</label>
          <input type="text" id="editProductCategory">
        </div>
        <div class="form-group">
          <label>Precio (S/.)</label>
          <input type="number" id="editProductPrice" step="0.01" required min="0">
        </div>
        <div class="form-group">
          <label>Stock (unidades)</label>
          <input type="number" id="editProductStock" required min="0">
        </div>
        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="closeEditProductModal()">Cancelar</button>
          <button type="submit" class="btn-primary">üíæ Guardar cambios</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: EDITAR PROMOCI√ìN -->
  <div id="editPromoModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚úèÔ∏è Editar Promo</h2>
        <button class="modal-close" onclick="closeEditPromoModal()">&times;</button>
      </div>
      <form id="editPromoForm">
        <div class="form-group form-row">
          <div class="form-group">
            <label>ID</label>
            <input type="text" id="editPromoId" disabled style="background: #eee; cursor: not-allowed;">
          </div>
          <div class="form-group">
            <label>Stock</label>
            <input type="number" id="editPromoStock" required min="0">
          </div>
        </div>
        <div class="form-group">
          <label>Nombre</label>
          <input type="text" id="editPromoName" required>
        </div>
        <div class="form-group">
          <label>Categor√≠a</label>
          <input type="text" id="editPromoCategory">
        </div>
        <div class="form-group form-row">
          <div class="form-group">
            <label>Precio Original (S/.)</label>
            <input type="number" id="editPromoOriginalPrice" step="0.01" required min="0" oninput="calculatePromoPrice()">
          </div>
          <div class="form-group">
            <label>Descuento (%)</label>
            <input type="number" id="editPromoDiscount" step="0.01" required min="0" max="100" oninput="calculatePromoPrice()">
          </div>
        </div>
        <div class="form-group">
          <label>üí∞ Precio Final (Autom√°tico)</label>
          <input type="text" id="editPromoFinalPrice" disabled style="background: #f0f0f0; cursor: not-allowed; color: #51ff00; font-weight: bold;">
        </div>
        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="closeEditPromoModal()">Cancelar</button>
          <button type="submit" class="btn-primary">üíæ Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: AGREGAR PRODUCTO -->
  <div id="addProductModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚ûï Nuevo Producto</h2>
        <button class="modal-close" onclick="closeAddProductModal()">&times;</button>
      </div>
      <form id="addProductForm">
        <div class="form-group">
          <label>Nombre*</label>
          <input type="text" id="addProductName" required placeholder="Ej: Prote√≠na XP">
        </div>
        <div class="form-group">
          <label>Categor√≠a*</label>
          <input type="text" id="addProductCategory" required placeholder="Ej: PROTE√çNAS">
        </div>
        <div class="form-group">
          <label>Precio (S/.)*</label>
          <input type="number" id="addProductPrice" step="0.01" required min="0" placeholder="Ej: 99.99">
        </div>
        <div class="form-group">
          <label>Stock (unidades)*</label>
          <input type="number" id="addProductStock" required min="0" placeholder="Ej: 10">
        </div>
        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="closeAddProductModal()">Cancelar</button>
          <button type="submit" class="btn-primary">‚úÖ Agregar Producto</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: AGREGAR PROMOCI√ìN -->
  <div id="addPromoModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üéâ Nueva Promoci√≥n</h2>
        <button class="modal-close" onclick="closeAddPromoModal()">&times;</button>
      </div>
      <form id="addPromoForm">
        <div class="form-group">
          <label>Nombre*</label>
          <input type="text" id="addPromoName" required placeholder="Ej: Pack Prote√≠na + Creatina">
        </div>
        <div class="form-group">
          <label>Categor√≠a*</label>
          <input type="text" id="addPromoCategory" required placeholder="Ej: OFERTAS">
        </div>
        <div class="form-group">
          <label>Precio Original (S/.)*</label>
          <input type="number" id="addPromoOriginalPrice" step="0.01" required min="0" placeholder="Ej: 500.00">
        </div>
        <div class="form-group">
          <label>Descuento (%)*</label>
          <input type="number" id="addPromoDiscount" required min="0" max="100" placeholder="Ej: 25">
        </div>
        <div class="form-group">
          <label>Stock (unidades)*</label>
          <input type="number" id="addPromoStock" required min="0" placeholder="Ej: 15">
        </div>
        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="closeAddPromoModal()">Cancelar</button>
          <button type="submit" class="btn-primary">‚úÖ Agregar Promoci√≥n</button>
        </div>
      </form>
    </div>
  </div>

  <!-- LOADER -->
  <div class="loader" id="loader">
    <div class="loader-spinner"></div>
    <p id="loaderText">Generando reportes...</p>
  </div>

  <!-- NOTIFICATION -->
  <div class="notification" id="notification"></div>

  <!-- Scripts -->
  <script src="assets/js/admin-export.js"></script>
  <script src="assets/js/admin-crm.js" type="module"></script>
</body>
</html>
